<div class="container my-5">
  <h2 class="mb-4">投稿詳細</h2>

  <table class="table table-bordered table-striped">
    <tbody>
      <tr>
        <th scope="row" style="width: 20%;">タイトル</th>
        <td><%= @post.title %></td>
      </tr>
      <tr>
        <th scope="row">カテゴリ</th>
        <td><%= @post.category&.name || "なし" %></td>
      </tr>
      <tr>
        <th scope="row">投稿者</th>
        <td><%= @post.user.full_name %></td>
      </tr>
      <tr>
        <th scope="row">本文</th>
        <td><%= simple_format(@post.body) %></td>
      </tr>
    </tbody>
  </table>

  <% if @post.images.attached? %>
    <div class="row mb-4">
      <% @post.images.each do |img| %>
        <div class="col-6 col-md-3 mb-3">
          <%= image_tag img,variant[resize:'300x300'] class: "img-fluid rounded shadow-sm", alt: @post.title %>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if @post.user == current_user %>
    <div class="mb-4">
      <%= link_to "編集", edit_public_post_path(@post), class: "btn btn-outline-primary mr-2" %>
      <%= link_to "削除", public_post_path(@post), method: :delete,
                  "data-confirm" => "本当に削除しますか？", class: "btn btn-outline-danger" %>
    </div>
  <% end %>

  <%= link_to "投稿一覧に戻る", about_path, class: "btn btn-success" %>
  
  <div class="d-flex align-items-center mb-3 mt-4">
    <h3 class="mb-0">コメント</h3>
    <i class="fa-slab fa-regular fa-comment fa-bounce fa-xl ml-2"></i>
    <h4 class="text-muted ml-2"><%= @post.comments.size %>件</h4>
  </div>

<% if @comment && @comment.errors.any? %>
  <div class="alert alert-danger">
    <ul class="mb-0">
      <% @comment.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with(model: [@post, @comment || Comment.new], url: public_post_comments_path(@post), local: true, class: "mb-4") do |f| %>
  <div class="form-group">
    <%= f.text_area :content, rows: 3, placeholder: "コメントを入力してください", class: "form-control" %>
  </div>
  <%= f.submit "コメントを投稿", class: "btn btn-primary" %>
<% end %>

<div class="mt-4">
  <% @post.comments.includes(:user).order(created_at: :desc).each do |comment| %>
    <div class="card mb-2">
      <div class="card-body d-flex p-2">
        <div class="me-2">
          <i class="fa-slab fa-regular fa-circle-user fa-xl" style="color: #cc870f;"></i>
        </div>

        <div>
          <strong><%= comment.user.last_name %>:</strong>
          <p class="mb-1"><%= comment.content %></p>
          <% if comment.user == current_user %>
          <i class="fa-solid fa-eraser fa-beat-fade"></i>
            <%= link_to "削除", public_post_comment_path(@post, comment),
                        method: :delete,
                        data: { confirm: "削除しますか？" },
                        class: "btn btn-sm btn-outline-danger" %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>