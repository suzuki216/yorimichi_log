<div class="container my-5">
  <h2 class="mb-4">投稿編集</h2>

  <%= form_with(model: @post, url: public_post_path(@post), local: true, html: { class: "needs-validation" }) do |f| %>
    
    <% if @post.errors.any? %>
      <div class="alert alert-danger">
        <h5><%= pluralize(@post.errors.count, "件のエラー") %>があります</h5>
        <ul>
          <% @post.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= f.label :title, "タイトル" %>
      <%= f.text_field :title, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :body, "本文" %>
      <%= f.text_area :body, class: "form-control", rows: 5 %>
    </div>

    <div class="form-group">
      <%= f.label :category_name, "カテゴリ" %>
      <%= f.text_field :category_name, value: @post.category&.name, placeholder: "カテゴリ名を入力", class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :images, "画像追加" %>
      <%= f.file_field :images, multiple: true, name: "post[images][]", class: "form-control-file" %>
    </div>

    <% if @post.images.attached? %>
      <div class="form-group">
        <label>現在の画像</label>
        <div class="row">
          <% @post.images.each do |img| %>
            <div class="col-6 col-md-3 mb-3 text-center">
              <%= image_tag img.variant(resize: '400x400'), class: "w-100 rounded mb-2" %>
              <div class="form-check">
                <%= check_box_tag "post[remove_image_ids][]", img.id, false, class: "form-check-input", id: "remove_image_#{img.id}" %>
                <%= label_tag "remove_image_#{img.id}", "削除", class: "form-check-label" %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <div class="form-group">
      <%= f.submit "更新", class: "btn btn-primary" %>
      <%= link_to "キャンセル", public_post_path(@post), class: "btn btn-secondary ml-2" %>
    </div>

  <% end %>
</div>
